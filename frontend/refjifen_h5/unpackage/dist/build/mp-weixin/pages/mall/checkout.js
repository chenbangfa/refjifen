(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/mall/checkout"],{"2ca2":function(e,t,r){},"3de2":function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){}));var n=function(){var e=this,t=e.$createElement,r=(e._self._c,e.__map(e.cart.items,(function(t,r){var n=e.__get_orig(t),a=t.image.split(","),o="A"==e.cart.zone?parseFloat(t.price):null,s="A"!=e.cart.zone?parseFloat(t.price):null;return{$orig:n,g0:a,m0:o,m1:s}})));e._isMounted||(e.e0=function(t){e.showPwd=!1},e.e1=function(t){e.showPwd=!1}),e.$mp.data=Object.assign({},{$root:{l0:r}})},a=[]},7951:function(e,t,r){"use strict";r.r(t);var n=r("3de2"),a=r("8d3e");for(var o in a)["default"].indexOf(o)<0&&function(e){r.d(t,e,(function(){return a[e]}))}(o);r("9810");var s=r("828b"),i=Object(s["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=i.exports},"8d3e":function(e,t,r){"use strict";r.r(t);var n=r("9ebb"),a=r.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},9810:function(e,t,r){"use strict";var n=r("2ca2"),a=r.n(n);a.a},"9ebb":function(e,t,r){"use strict";(function(e){var n=r("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r("7eb4")),o=n(r("ee10"));function s(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var c={data:function(){return{cart:{zone:"",items:[]},address:null,remark:"",showPwd:!1,password:"",rules:[],user:{}}},computed:{totalPrice:function(){if(!this.cart.items)return 0;var e=this.cart.items.reduce((function(e,t){return e+t.price*t.qty}),0);return parseFloat(e).toFixed(2)},estRatio:function(){if(!this.rules||!this.rules.length)return 0;var e,t=parseFloat(this.totalPrice),r=0,n=s(this.rules);try{for(n.s();!(e=n.n()).done;){var a=e.value;t>=parseFloat(a.min_amount)&&(r=parseFloat(a.ratio))}}catch(o){n.e(o)}finally{n.f()}return r},estPoints:function(){return(parseFloat(this.totalPrice)*this.estRatio).toFixed(2)}},onShow:function(){var t=e.getStorageSync("selected_address");t?(this.address=t,e.removeStorageSync("selected_address")):this.address||this.loadDefaultAddress(),this.loadRules(),this.fetchUserInfo()},onLoad:function(){var t=e.getStorageSync("checkout_cart");t?this.cart=t:e.navigateBack()},methods:{loadRules:function(){var t=this;return(0,o.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.$api("mall.php?action=config");case 3:n=r.sent,200==n.code&&(t.rules=n.data.reward_rules||[]),r.next=9;break;case 7:r.prev=7,r.t0=r["catch"](0);case 9:case"end":return r.stop()}}),r,null,[[0,7]])})))()},fetchUserInfo:function(){var t=this;return(0,o.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.$api("account.php?action=info");case 3:n=r.sent,200==n.code&&(t.user=n.data),r.next=9;break;case 7:r.prev=7,r.t0=r["catch"](0);case 9:case"end":return r.stop()}}),r,null,[[0,7]])})))()},loadDefaultAddress:function(){var t=this;return(0,o.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.$api("address.php?action=list");case 3:n=r.sent,200==n.code&&n.data.length>0&&(t.address=n.data[0]),r.next=9;break;case 7:r.prev=7,r.t0=r["catch"](0);case 9:case"end":return r.stop()}}),r,null,[[0,7]])})))()},selectAddress:function(){e.navigateTo({url:"/pages/address/list?select=1"})},prePay:function(){if(!this.address)return e.showToast({title:"请选择收货地址",icon:"none"});!this.user||this.user.has_pay_password?(this.password="",this.showPwd=!0):e.showModal({title:"提示",content:"请先设置支付密码",confirmText:"去设置",success:function(t){t.confirm&&e.navigateTo({url:"/pages/my/pay_password"})}})},doPay:function(){var t=this;return(0,o.default)(a.default.mark((function r(){var n,o;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.password){r.next=2;break}return r.abrupt("return",e.showToast({title:"请输入密码",icon:"none"}));case 2:return e.showLoading({title:"支付中"}),r.prev=3,n={items:t.cart.items,zone:t.cart.zone,pay_password:t.password,receiver_info:t.address,remark:t.remark},r.next=7,e.$api("mall.php?action=buy","POST",n);case 7:o=r.sent,e.hideLoading(),200==o.code?(e.showToast({title:"支付成功"}),e.removeStorageSync("checkout_cart"),setTimeout((function(){e.reLaunch({url:"/pages/mall/profile"})}),1500)):e.showToast({title:o.message||"支付失败",icon:"none"}),t.showPwd=!1,r.next=17;break;case 13:r.prev=13,r.t0=r["catch"](3),e.hideLoading(),e.showToast({title:"请求失败",icon:"none"});case 17:case"end":return r.stop()}}),r,null,[[3,13]])})))()}}};t.default=c}).call(this,r("df3c")["default"])},e609:function(e,t,r){"use strict";(function(e,t){var n=r("47a9");r("a82b");n(r("3240"));var a=n(r("7951"));e.__webpack_require_UNI_MP_PLUGIN__=r,t(a.default)}).call(this,r("3223")["default"],r("df3c")["createPage"])}},[["e609","common/runtime","common/vendor"]]]);