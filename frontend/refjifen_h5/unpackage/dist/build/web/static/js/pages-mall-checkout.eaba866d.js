(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-mall-checkout"],{"0748":function(t,e,a){var i=a("1c1e");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=a("967d").default;n("3826c6fc",i,!0,{sourceMap:!1,shadowMode:!1})},"1c1e":function(t,e,a){var i=a("c86c");e=i(!1),e.push([t.i,".container[data-v-3dc8bc48]{padding:10px;padding-bottom:60px}.address-box[data-v-3dc8bc48]{background:#fff;border-radius:8px;padding:15px;margin-bottom:12px;position:relative;overflow:hidden}.addr-info[data-v-3dc8bc48]{display:flex;flex-direction:column}.addr-user[data-v-3dc8bc48]{margin-bottom:5px;font-size:16px;font-weight:700}.addr-user .mobile[data-v-3dc8bc48]{margin-left:10px;color:#666;font-size:14px;font-weight:400}.addr-detail[data-v-3dc8bc48]{color:#333;font-size:14px;line-height:1.4}.addr-empty[data-v-3dc8bc48]{height:40px;display:flex;align-items:center;justify-content:center;color:#666}.addr-line[data-v-3dc8bc48]{position:absolute;bottom:0;left:0;right:0;height:4px;background:repeating-linear-gradient(-45deg,#ff6c6c,#ff6c6c 20px,#fff 0,#fff 25px,#1989fa 0,#1989fa 45px,#fff 0,#fff 50px)}.order-list[data-v-3dc8bc48]{background:#fff;border-radius:8px;margin-bottom:12px;padding:0 10px}.product-item[data-v-3dc8bc48]{display:flex;padding:15px 0;border-bottom:1px solid #f9f9f9}.product-item[data-v-3dc8bc48]:last-child{border-bottom:none}.p-img[data-v-3dc8bc48]{width:80px;height:80px;border-radius:6px;background:#eee;margin-right:10px}.p-info[data-v-3dc8bc48]{flex:1;display:flex;flex-direction:column;justify-content:space-between}.p-title[data-v-3dc8bc48]{font-size:14px;color:#333;line-height:1.4}.p-meta[data-v-3dc8bc48]{display:flex;justify-content:space-between;align-items:center}.p-price[data-v-3dc8bc48]{font-size:16px;font-weight:700;color:#333}.p-qty[data-v-3dc8bc48]{color:#999;font-size:13px}.cell-group[data-v-3dc8bc48]{background:#fff;border-radius:8px;padding:0 15px;margin-bottom:12px}.cell-item[data-v-3dc8bc48]{display:flex;align-items:center;height:50px}.label[data-v-3dc8bc48]{width:60px;font-size:14px;color:#333}.input[data-v-3dc8bc48]{flex:1;font-size:14px}.footer-bar[data-v-3dc8bc48]{position:fixed;bottom:0;left:0;width:100%;height:50px;background:#fff;display:flex;align-items:center;padding:0 15px;box-shadow:0 -2px 10px rgba(0,0,0,.05);box-sizing:border-box;justify-content:space-between;z-index:100}.total-info[data-v-3dc8bc48]{font-size:14px;color:#333}.est-points[data-v-3dc8bc48]{position:absolute;top:-30px;left:0;width:100%;background:#fdf6ec;color:#e6a23c;font-size:12px;height:30px;display:flex;align-items:center;padding:0 15px;box-sizing:border-box}.total-price[data-v-3dc8bc48]{font-size:18px;color:#ff4d4f;font-weight:700;margin-left:5px}.pay-btn[data-v-3dc8bc48]{background:#07c160;color:#fff;padding:8px 25px;border-radius:20px;font-size:14px;font-weight:700}\n\n/* Pwd Modal */.pwd-mask[data-v-3dc8bc48]{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:999}.pwd-modal[data-v-3dc8bc48]{position:fixed;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);width:80%;background:#fff;border-radius:12px;padding:20px;z-index:1000;text-align:center}.pwd-title[data-v-3dc8bc48]{font-size:16px;font-weight:700;margin-bottom:20px}.pwd-input[data-v-3dc8bc48]{border:1px solid #ddd;height:40px;border-radius:4px;padding:0 10px;margin-bottom:20px;text-align:center}.pwd-btns[data-v-3dc8bc48]{display:flex;justify-content:space-between}.pwd-btns .btn[data-v-3dc8bc48]{width:48%;padding:10px 0;border-radius:4px;font-size:14px}.btn.cancel[data-v-3dc8bc48]{background:#f5f5f5;color:#666}.btn.confirm[data-v-3dc8bc48]{background:#07c160;color:#fff}.p-unit[data-v-3dc8bc48]{font-size:12px;color:#ccc;font-weight:400;margin-left:1px}",""]),t.exports=e},3471:function(t,e,a){"use strict";a("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){var a="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=(0,i.default)(t))||e&&t&&"number"===typeof t.length){a&&(t=a);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,c=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return o=t.done,t},e:function(t){c=!0,r=t},f:function(){try{o||null==a["return"]||a["return"]()}finally{if(c)throw r}}}},a("01a2"),a("e39c"),a("bf0f"),a("844d"),a("18f7"),a("de6c"),a("7a76"),a("c9b5");var i=function(t){return t&&t.__esModule?t:{default:t}}(a("5d6b"))},7951:function(t,e,a){"use strict";a.r(e);var i=a("8148"),n=a("8d3e");for(var s in n)["default"].indexOf(s)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(s);a("ea71");var r=a("828b"),o=Object(r["a"])(n["default"],i["b"],i["c"],!1,null,"3dc8bc48",null,!1,i["a"],void 0);e["default"]=o.exports},8148:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"container"},[a("v-uni-view",{staticClass:"address-box",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.selectAddress.apply(void 0,arguments)}}},[t.address?a("v-uni-view",{staticClass:"addr-info"},[a("v-uni-view",{staticClass:"addr-user"},[a("v-uni-text",{staticClass:"name"},[t._v(t._s(t.address.name))]),a("v-uni-text",{staticClass:"mobile"},[t._v(t._s(t.address.mobile))])],1),a("v-uni-view",{staticClass:"addr-detail"},[t._v(t._s(t.address.province)+" "+t._s(t.address.city)+" "+t._s(t.address.district)+" "+t._s(t.address.detail))])],1):a("v-uni-view",{staticClass:"addr-empty"},[a("v-uni-text",[t._v("请选择收货地址")]),a("v-uni-text",{staticClass:"iconfont icon-right"})],1),a("v-uni-view",{staticClass:"addr-line"})],1),a("v-uni-view",{staticClass:"order-list"},t._l(t.cart.items,(function(e){return a("v-uni-view",{key:e.id,staticClass:"product-item"},[a("v-uni-image",{staticClass:"p-img",attrs:{src:e.image.split(",")[0],mode:"aspectFill"}}),a("v-uni-view",{staticClass:"p-info"},[a("v-uni-view",{staticClass:"p-title"},[t._v(t._s(e.title))]),a("v-uni-view",{staticClass:"p-meta"},["A"==t.cart.zone?a("v-uni-view",{staticClass:"p-price"},[t._v("¥"+t._s(parseFloat(e.price))),a("v-uni-text",{staticClass:"p-unit"},[t._v("/"+t._s(e.unit||"件"))])],1):a("v-uni-view",{staticClass:"p-price",staticStyle:{color:"#ff9800"}},[t._v(t._s(parseFloat(e.price))),a("v-uni-text",{staticClass:"p-unit",staticStyle:{color:"#ffcc80"}},[t._v("券/"+t._s(e.unit||"件"))])],1),a("v-uni-view",{staticClass:"p-qty"},[t._v("x "+t._s(e.qty)+t._s(e.unit))])],1)],1)],1)})),1),a("v-uni-view",{staticClass:"cell-group"},[a("v-uni-view",{staticClass:"cell-item"},[a("v-uni-text",{staticClass:"label"},[t._v("备注")]),a("v-uni-input",{staticClass:"input",attrs:{placeholder:"选填，请先和商家协商一致"},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}})],1)],1),a("v-uni-view",{staticClass:"footer-bar"},[a("v-uni-view",{staticClass:"total-info"},[a("v-uni-text",[t._v("合计:")]),"A"==t.cart.zone?a("v-uni-text",{staticClass:"total-price"},[t._v("¥"+t._s(t.totalPrice))]):a("v-uni-text",{staticClass:"total-price"},[t._v(t._s(t.totalPrice)+"券")])],1),"A"==t.cart.zone&&t.estPoints>0?a("v-uni-view",{staticClass:"est-points"},[a("v-uni-text",[t._v("预估赠送: "+t._s(t.estPoints)+" ("+t._s(t.estRatio)+"倍)")])],1):t._e(),a("v-uni-view",{staticClass:"pay-btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.prePay.apply(void 0,arguments)}}},[t._v("立即支付")])],1),t.showPwd?a("v-uni-view",{staticClass:"pwd-mask",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showPwd=!1}}}):t._e(),t.showPwd?a("v-uni-view",{staticClass:"pwd-modal"},[a("v-uni-view",{staticClass:"pwd-title"},[t._v("输入支付密码")]),a("v-uni-input",{staticClass:"pwd-input",attrs:{type:"password",focus:!0,maxlength:"6",placeholder:"请输入6位支付密码"},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),a("v-uni-view",{staticClass:"pwd-btns"},[a("v-uni-view",{staticClass:"btn cancel",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showPwd=!1}}},[t._v("取消")]),a("v-uni-view",{staticClass:"btn confirm",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.doPay.apply(void 0,arguments)}}},[t._v("确定")])],1)],1):t._e()],1)},n=[]},"8d3e":function(t,e,a){"use strict";a.r(e);var i=a("998e"),n=a.n(i);for(var s in i)["default"].indexOf(s)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(s);e["default"]=n.a},"998e":function(t,e,a){"use strict";a("6a54");var i=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(a("2634")),s=i(a("2fdc")),r=i(a("3471"));a("473f"),a("bf0f"),a("e838");var o={data:function(){return{cart:{zone:"",items:[]},address:null,remark:"",showPwd:!1,password:"",rules:[],user:{}}},computed:{totalPrice:function(){if(!this.cart.items)return 0;var t=this.cart.items.reduce((function(t,e){return t+e.price*e.qty}),0);return parseFloat(t).toFixed(2)},estRatio:function(){if(!this.rules||!this.rules.length)return 0;var t,e=parseFloat(this.totalPrice),a=0,i=(0,r.default)(this.rules);try{for(i.s();!(t=i.n()).done;){var n=t.value;e>=parseFloat(n.min_amount)&&(a=parseFloat(n.ratio))}}catch(s){i.e(s)}finally{i.f()}return a},estPoints:function(){return(parseFloat(this.totalPrice)*this.estRatio).toFixed(2)}},onShow:function(){var t=uni.getStorageSync("selected_address");t?(this.address=t,uni.removeStorageSync("selected_address")):this.address||this.loadDefaultAddress(),this.loadRules(),this.fetchUserInfo()},onLoad:function(){var t=uni.getStorageSync("checkout_cart");t?this.cart=t:uni.navigateBack()},methods:{loadRules:function(){var t=this;return(0,s.default)((0,n.default)().mark((function e(){var a;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,uni.$api("mall.php?action=config");case 3:a=e.sent,200==a.code&&(t.rules=a.data.reward_rules||[]),e.next=9;break;case 7:e.prev=7,e.t0=e["catch"](0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})))()},fetchUserInfo:function(){var t=this;return(0,s.default)((0,n.default)().mark((function e(){var a;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,uni.$api("account.php?action=info");case 3:a=e.sent,200==a.code&&(t.user=a.data),e.next=9;break;case 7:e.prev=7,e.t0=e["catch"](0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})))()},loadDefaultAddress:function(){var t=this;return(0,s.default)((0,n.default)().mark((function e(){var a;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,uni.$api("address.php?action=list");case 3:a=e.sent,200==a.code&&a.data.length>0&&(t.address=a.data[0]),e.next=9;break;case 7:e.prev=7,e.t0=e["catch"](0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})))()},selectAddress:function(){uni.navigateTo({url:"/pages/address/list?select=1"})},prePay:function(){if(!this.address)return uni.showToast({title:"请选择收货地址",icon:"none"});!this.user||this.user.has_pay_password?(this.password="",this.showPwd=!0):uni.showModal({title:"提示",content:"请先设置支付密码",confirmText:"去设置",success:function(t){t.confirm&&uni.navigateTo({url:"/pages/my/pay_password"})}})},doPay:function(){var t=this;return(0,s.default)((0,n.default)().mark((function e(){var a,i;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.password){e.next=2;break}return e.abrupt("return",uni.showToast({title:"请输入密码",icon:"none"}));case 2:return uni.showLoading({title:"支付中"}),e.prev=3,a={items:t.cart.items,zone:t.cart.zone,pay_password:t.password,receiver_info:t.address,remark:t.remark},e.next=7,uni.$api("mall.php?action=buy","POST",a);case 7:i=e.sent,uni.hideLoading(),200==i.code?(uni.showToast({title:"支付成功"}),uni.removeStorageSync("checkout_cart"),setTimeout((function(){uni.reLaunch({url:"/pages/mall/profile"})}),1500)):uni.showToast({title:i.message||"支付失败",icon:"none"}),t.showPwd=!1,e.next=17;break;case 13:e.prev=13,e.t0=e["catch"](3),uni.hideLoading(),uni.showToast({title:"请求失败",icon:"none"});case 17:case"end":return e.stop()}}),e,null,[[3,13]])})))()}}};e.default=o},ea71:function(t,e,a){"use strict";var i=a("0748"),n=a.n(i);n.a}}]);